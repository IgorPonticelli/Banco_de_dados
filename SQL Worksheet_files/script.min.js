const livesql={getPreferredEditorTheme:()=>$("body").hasClass("is-darkmode")?"dark":"light",parserDirectory:apex.env.APP_FILES+"/oracle-sql",initWorksheetEditor:()=>{let e=()=>[];(async()=>{let t="Y"===apex.items.P1_PREF_LINE_NUMBERS.value,s="Y"===apex.items.P1_PREF_CLOSE_BRACKETS.value;const o="worksheet-font-size-small",n="worksheet-font-size-medium",r="worksheet-font-size-large",a="worksheet-font-size-custom",l=()=>$("body").hasClass(a),i=()=>$(":root").css("--worksheet-font-size")?.trim()?.replace("px","")||null,d=()=>{apex.server.process("set_preferences",{x01:t?"Y":"N",x02:s?"Y":"N",x03:$("body").hasClass(o)?"small":$("body").hasClass(n)?null:$("body").hasClass(r)?"large":i()})},m=new CodeEditor("editor",{lineNumbers:t,closeBrackets:s,theme:livesql.getPreferredEditorTheme()},[CodeMirror["@codemirror/view"].keymap.of([{key:"Ctrl-Enter",run:()=>(apex.livesql.run(),!0)},{key:"Cmd-Enter",run:()=>(apex.livesql.run(),!0)}]),CodeMirror["@codemirror/lint"].linter((t=>e(m.getEditor().state.doc,m.getValue())),{delay:300})]);m.setValue(apex.items.P1_SQL.value);const u=$("#actions_menu"),c=u.menu("option","items");c.push({type:"separator"}),c.push({type:"toggle",label:"Show Line Numbers",set:e=>{t=!t,m.setOptions({lineNumbers:t}),d()},get:()=>t}),c.push({type:"toggle",label:"Auto-close Brackets",set:e=>{s=!s,m.setOptions({closeBrackets:s}),d()},get:()=>s});const g=e=>{$("body").removeClass(o).removeClass(n).removeClass(r).removeClass(a),[o,n,r].includes(e)?$("body").addClass(e):($("body").addClass(a),$(":root").css("--worksheet-font-size",e+"px")),d()},p=()=>"Custom..."+(l()?`(${i()}px)`:"");c.push({href:"",icon:"fa-font-size",iconType:"fa",label:"Worksheet Font Size",type:"subMenu",action:"font-size-action",menu:{items:[{type:"toggle",label:"Small",set:()=>{g(o)},get:()=>$("body").hasClass(o)},{type:"toggle",label:"Medium (Default)",set:()=>{g(n)},get:()=>$("body").hasClass(n)},{type:"toggle",label:"Large",set:()=>{g(r)},get:()=>$("body").hasClass(r)},{type:"toggle",label:p(),set:()=>{const e=prompt("Enter the font size in pixels");if(null===e)return;const t=parseInt(e);isNaN(t)||t<1||t>100?alert("The font size must be a valid number between 1 and 100px"):g(t)},get:l}]}}),u.on("menubeforeopen",(()=>{c[c.length-1].menu.items[3].label=p()}));const h=await new Promise((e=>{require([livesql.parserDirectory+"/main.js"],(function(t){e(t.getParsingErrors)}))}));e=(e,t)=>new Promise((s=>{h(t).then((t=>{function o(e,t,s){return e.line(t+1).from+s}const n=e.text.length,r=[];for(let s=0;s<t.length;s++){const a=t[s];a.range.start.line+1>n||a.range.end.line+1>n||a.range.start.column>e.line(a.range.start.line+1).length||a.range.end.column>e.line(a.range.end.line+1).length||r.push({from:o(e,a.range.start.line,a.range.start.column),to:o(e,a.range.end.line,a.range.end.column),severity:"warning",message:a.options.message})}s(r)}))}))})()}};$("#t_TreeNav").on("theme42layoutchanged",(function(e,t){"expand"===t.action&&$("#t_Button_navControl").is(":focus")&&setTimeout((()=>{$("#t_TreeNav").treeView("setSelection",$("#t_TreeNav .a-TreeView-node").first(),!0)}),100)})),$("#t_TreeNav").on("keyup",(function(e){27==e.which&&$("#t_Button_navControl").click()})),$("body").on("theme-change",(()=>{"undefined"!=typeof CodeEditor&&Object.keys(CodeEditor).forEach((e=>{CodeEditor[e].setOptions({theme:livesql.getPreferredEditorTheme()})}))}));